/*
 * This file is part of the Confirmate project.
 */
@file:OptIn(ExperimentalUuidApi::class)

import de.fraunhofer.aisec.confirmate.queries.catalogs.german.BSI_TR02102
import de.fraunhofer.aisec.confirmate.queries.cra.*
import de.fraunhofer.aisec.cpg.graph.concepts.autoGenerated.AuthenticationOperation
import de.fraunhofer.aisec.cpg.graph.concepts.autoGenerated.DatabaseOperation
import de.fraunhofer.aisec.cpg.graph.concepts.autoGenerated.FileOperation
import de.fraunhofer.aisec.cpg.graph.concepts.autoGenerated.HttpClientOperation
import kotlin.uuid.ExperimentalUuidApi

include {
    // No includes so far
}

project {
    name = "Example CRA project"

    toe {
        name = "Example project"
        version = "1.0.0"

        architecture {
            modules {
                module("test-module") {
                    directory = "src/main/kotlin/resources/toe"
                    include("toe")
                }
            }
        }
    }

    requirements {
        category("CRA") {
            requirement {
                name = "X.1.1.6"
                description =
                    "Products with digital elements shall protect the confidentiality of stored, transmitted or otherwise processed data, personal or other, such as by encrypting relevant data at rest or in transit by state of the art mechanisms, and by using other technical means;"

                fulfilledBy {
                    with(BSI_TR02102()) {
                        dataEncryptedBeforePersisting() and dataInTransitEncrypted()
                    }
                }
            }

            requirement {
                name = "X.1.1.13"
                description =
                    " Products with digital elements shall provide security related information by recording and monitoring relevant internal activity, including the access to or modification of data, services or functions, with an opt-out mechanism for the user;"

                fulfilledBy {
                    relevantActivityHasLogging {
                        it is FileOperation ||
                            it is DatabaseOperation ||
                            it is HttpClientOperation ||
                            it is
                                AuthenticationOperation /* TODO: No modifications to settings possible yet*/
                    } and
                        logEntriesHaveTimestamp() and
                        logEntriesContainInitiator() and
                        loggingOptOut {
                            false /* There's no opt-out mechanism we can identify. */
                        } and
                        loggingEnabledByDefault() /* and
                                                  loggedDataAvailableToUser()*/
                }
            }
        }
    }
}
